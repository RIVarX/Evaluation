<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Drug Administration</title>
  <style>
    table {
      border-collapse: collapse;
      margin: auto;
    }
    td {
      border: 1px solid black;
      padding: 5px;
      text-align: center;
    }
    input {
      border: none;
      text-align: center;
      font-weight: bold;
    }
    input[type="number"] {
      width: 60px;
    }
    input[readonly] {
      font-style: italic;
    }
  </style>
   
</head>
<body>
  <table>
    <tr>
      <td>Drug</td>
      <td>Concentration</td>
      <td>VolumeOfFluid</td>
    </tr>
    <tr>
      <td><input id="drug" type="number"></td>
      <td><input id="concentration" type="number" step="0.01"></td>
      <td><input id="volume" type="number" ></td>
    </tr>
    <tr>
      <td>Dose</td>
      <td>Duration</td>
      <td>Rate</td>
    </tr>
    <tr>
      <td><input id="dose" type="number" ></td>
      <td><input id="duration" type="number" ></td>
      <td><input id="rate" type="number" ></td>
    </tr>
  </table>

  <script src="https://unpkg.com/rxjs@^7/dist/bundles/rxjs.umd.min.js"></script>
  <script src="https://unpkg.com/rivarjs/dist/rivar.umd.js"></script>

  
 
 
  <script> 
//const { Subject, share } = rxjs;
const { RIVar,lift, Signal } = rivarjs;
 
  

const div = (x, y) => x / y;
const mul = (x, y) => x * y;

class Bag {
  constructor() {
    this.amount = new RIVar();
    this.volume = new RIVar();
    this.concentration = new RIVar();

    this.concentration.set(lift(div, this.amount, this.volume));
    this.amount.set(lift(mul, this.concentration, this.volume));
    this.volume.set(lift(div, this.amount, this.concentration));
  }
}
  
  class Pump {
    constructor(bag) {
      this.rate = new RIVar();
      this.dose = new RIVar();
      this.duration = new RIVar();
      this.theBag = bag;
  
      this.dose.set(lift(div, this.theBag.amount, this.duration));
      this.rate.set(lift(div, this.theBag.volume, this.duration));
  
      this.duration.set(lift(div, this.theBag.amount, this.dose));
      this.duration.set(lift(div, this.theBag.volume, this.rate));
  
      this.theBag.amount.set(lift(mul, this.duration, this.dose));
      this.theBag.volume.set(lift(mul, this.duration, this.rate));
    }
  }

  const bag = new Bag();
  const pump = new Pump(bag);

  function bind(inputID,variable){

    var input = document.getElementById(inputID);
    
    input.addEventListener('input', (event) => {
      const value = event.target.value;
      variable.next(new Signal(value));
      input.style.fontStyle = "normal";
    });
  
    variable.subscribe((signal) => {
    if(!(parseFloat(input.value)==signal.value.toFixed(2)))
    {
      input.value=signal.value.toFixed(2);
      input.style.fontStyle = "italic";
    }
   
     

   
    console.log(signal);
    });
  
  }


  bind("drug",bag.amount)
  bind("concentration",bag.concentration)
  bind("volume",bag.volume)
  bind("dose",pump.dose)
  bind("duration",pump.duration)
  bind("rate",pump.rate)


  document.getElementById("volume").value=300;
  document.getElementById("drug").value=100;
  document.getElementById("duration").value=10;
    bag.volume.next(new Signal(300));
  bag.amount.next(new Signal(100));
  pump.duration.next(new Signal(10));
      </script>



</body>
</html>
